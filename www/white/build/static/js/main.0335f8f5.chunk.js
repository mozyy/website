(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{48:function(e){e.exports={websocketPort:"6503",development:{url:"localhost",websocket:"ws://localhost:6503"},production:{url:"yyue.dev",websocket:"wss://yyue.dev:6503"}}},58:function(e,n,t){e.exports=t(81)},63:function(e,n,t){},64:function(e,n,t){},81:function(e,n,t){"use strict";t.r(n);var r=t(0),a=t.n(r),o=t(9),c=t.n(o),i=(t(63),t(105)),s=(t(80),t(64),t(7)),u=t.n(s),l=t(12),d=t(13),f=t(53),p=t(82),h=t(44),v=t.n(h),g=t(108),b=t(109),w=t(107),k=t(51),m=t.n(k),C=t(49),y=t.n(C),E=function(e){var n=JSON.stringify(e);return(new TextEncoder).encode(n)},O=function(e){var n=(new TextDecoder).decode(e);return JSON.parse(n)},x=function(e){return e.data.arrayBuffer().then(O)},S=t(45),j=t(46),M=t(54),T=t(28),R=t(47),D=t(55),L=t(48).production.websocket,P=console.log.bind(console,"%c[[WebRTC]]: ","color: red"),W=function(e){function n(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{channel:"testChannel"};return Object(S.a)(this,n),(e=Object(M.a)(this,Object(T.a)(n).call(this))).options=void 0,e.uid=0,e.webSocket=void 0,e.rtcConnMaps=new Map,e.dataChannelMaps=new Map,e.userlist=void 0,e.options=t,e}return Object(R.a)(n,e),Object(j.a)(n,[{key:"init",value:function(){var e=Object(l.a)(u.a.mark(function e(){var n;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.createWebSocket();case 2:this.webSocket=e.sent,n={kind:"join",uid:this.uid,value:{channel:this.options.channel}},this.sendMessage(n);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"createWebSocket",value:function(){var e=this,n=new WebSocket(L);return n.addEventListener("close",function(n){P("websocket closed"),e.dispatchEvent(new CloseEvent("websocketclosed",{code:n.code,reason:n.reason}))}),n.addEventListener("message",function(){var n=Object(l.a)(u.a.mark(function n(t){var r,a,o,c,i,s,l,d;return u.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,x(t);case 2:r=n.sent,P("received websocket message: ",r),e.dispatchEvent(t),a=r.kind,o=r.value,c=r.uid,i=r.target,n.t0=a,n.next="join-success"===n.t0?9:"userlist"===n.t0?11:"user-joined"===n.t0?13:"create-answer"===n.t0?19:"create-offer"===n.t0?21:"new-ice-candidate"===n.t0?23:"hang-up"===n.t0?25:27;break;case 9:return e.uid=i||0,n.abrupt("break",28);case 11:return e.userlist=o,n.abrupt("break",28);case 13:return s=c,l=e.createRTCPeerConn(s),d=l.createDataChannel(String(e.uid)),e.createOffer(s),e.createRTCDataChannel(s,d),n.abrupt("break",28);case 19:return e.receiveCreateAnswer(c,o),n.abrupt("break",28);case 21:return e.receiveCreateOffer(c,o),n.abrupt("break",28);case 23:return e.receiveNewICECandidate(c,o),n.abrupt("break",28);case 25:return e.closeRTCCall(e.rtcConnMaps.get(c)),n.abrupt("break",28);case 27:P("receive: Unknown message");case 28:case"end":return n.stop()}},n)}));return function(e){return n.apply(this,arguments)}}()),new Promise(function(e,t){n.addEventListener("open",function(t){e(n)}),n.addEventListener("error",function(e){t(e)})})}},{key:"createRTCPeerConn",value:function(e){var n=this,t=new RTCPeerConnection({iceServers:[{urls:["stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302","stun:stun3.l.google.com:19302","stun:stun4.l.google.com:19302","stun:23.21.150.121","stun:stun01.sipphone.com","stun:stun.ekiga.net","stun:stun.fwdnet.net","stun:stun.ideasip.com","stun:stun.iptel.org","stun:stun.rixtelecom.se","stun:stun.schlund.de","stun:stunserver.org","stun:stun.softjoys.com","stun:stun.voiparound.com","stun:stun.voipbuster.com","stun:stun.voipstunt.com","stun:stun.voxgratia.org","stun:stun.xten.com"]}]});return t.addEventListener("icecandidate",function(t){if(t.candidate){P("*** Outgoing ICE candidate: "+t.candidate.candidate);var r={kind:"new-ice-candidate",uid:n.uid,target:e,value:{candidate:t.candidate}};n.sendMessage(r)}}),t.addEventListener("iceconnectionstatechange",function(){switch(P("*** ICE connection state changed to "+t.iceConnectionState),t.iceConnectionState){case"closed":case"failed":case"disconnected":n.closeRTCCall(t)}}),t.addEventListener("icegatheringstatechange",function(){P("*** ICE gathering state changed to: "+t.iceGatheringState)}),t.addEventListener("signalingstatechange",function(){switch(P("*** WebRTC signaling state changed to: "+t.signalingState),t.signalingState){case"closed":n.closeRTCCall(t)}}),t.addEventListener("negotiationneeded",function(){n.createOffer(e)}),t.addEventListener("datachannel",function(e){var t=e.channel;n.createRTCDataChannel(Number(t.label),e.channel)}),this.rtcConnMaps.set(e,t),t}},{key:"createRTCDataChannel",value:function(e,n){var t=this,r=function(){console.log("current data channel state: ",n.readyState)};return n.addEventListener("open",r),n.addEventListener("close",r),n.addEventListener("message",function(e){t.dispatchEvent(new CustomEvent("datachannelmessage",{detail:e}))}),this.dataChannelMaps.set(e,n),n}},{key:"createOffer",value:function(){var e=Object(l.a)(u.a.mark(function e(n){var t,r,a;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(t=this.rtcConnMaps.get(n))||(t=this.createRTCPeerConn(n)),P("Creating offer"),e.next=5,t.createOffer();case 5:if(r=e.sent,"stable"==t.signalingState){e.next=9;break}return P("     -- The connection isn't stable yet; postponing..."),e.abrupt("return");case 9:return P("---\x3e Setting local description to the offer"),e.next=12,t.setLocalDescription(r);case 12:P("---\x3e Sending the offer to the remote peer"),a={kind:"create-offer",uid:this.uid,target:n,value:{sdp:t.localDescription}},this.sendMessage(a);case 15:case"end":return e.stop()}},e,this)}));return function(n){return e.apply(this,arguments)}}()},{key:"sendMessage",value:function(e){this.webSocket&&this.webSocket.send(E(e))}},{key:"closeRTCCall",value:function(e){e&&(P("--\x3e Closing the peer connection"),e.ontrack=null,e.onicecandidate=null,e.oniceconnectionstatechange=null,e.onsignalingstatechange=null,e.onicegatheringstatechange=null,e.onnegotiationneeded=null,e.getTransceivers().forEach(function(e){e.stop()}),e.close())}},{key:"receiveCreateOffer",value:function(){var e=Object(l.a)(u.a.mark(function e(n,t){var r,a,o;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((r=this.rtcConnMaps.get(n))||(r=this.createRTCPeerConn(n)),P("Received video chat offer from "+n),a=new RTCSessionDescription(t.sdp),"stable"==r.signalingState){e.next=11;break}return P("  - But the signaling state isn't stable, so triggering rollback"),e.next=8,Promise.all([r.setLocalDescription({type:"rollback"}),r.setRemoteDescription(a)]).catch(function(e){return P("setLocalDescription error: ",e)});case 8:return e.abrupt("return");case 11:return P("  - Setting remote description"),e.next=14,r.setRemoteDescription(a);case 14:return P("---\x3e Creating and sending answer to caller"),e.t0=r,e.next=18,r.createAnswer();case 18:return e.t1=e.sent,e.next=21,e.t0.setLocalDescription.call(e.t0,e.t1);case 21:o={kind:"create-answer",uid:this.uid,target:n,value:{sdp:r.localDescription}},this.sendMessage(o);case 23:case"end":return e.stop()}},e,this)}));return function(n,t){return e.apply(this,arguments)}}()},{key:"receiveCreateAnswer",value:function(){var e=Object(l.a)(u.a.mark(function e(n,t){var r;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return P("*** Call recipient has accepted our call"),r=new RTCSessionDescription(t.sdp),e.next=4,this.rtcConnMaps.get(n).setRemoteDescription(r);case 4:case"end":return e.stop()}},e,this)}));return function(n,t){return e.apply(this,arguments)}}()},{key:"receiveNewICECandidate",value:function(){var e=Object(l.a)(u.a.mark(function e(n,t){var r;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new RTCIceCandidate(t.candidate),P("*** Adding received ICE candidate: "+JSON.stringify(r)),e.next=4,this.rtcConnMaps.get(n).addIceCandidate(r);case 4:case"end":return e.stop()}},e,this)}));return function(n,t){return e.apply(this,arguments)}}()},{key:"handleClose",value:function(){this.webSocket&&this.webSocket.close(),this.rtcConnMaps.forEach(function(e){return e.close()}),this.dataChannelMaps.forEach(function(e){return e.close()})}},{key:"dataChannelsSend",value:function(e){var n=E(e);this.dataChannelMaps.forEach(function(e){try{e.send(n)}catch(t){console.log("send data channel message failed: ",t)}})}}]),n}(Object(D.a)(EventTarget));function A(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}var N=Object(p.a)(function(e){return{root:{width:"100%",height:"100vh",display:"block",touchAction:"none"},speedDial:{position:"absolute",bottom:e.spacing(2),right:e.spacing(3)}}}),I=function(e){var n,t={x:0,y:0};switch(e.type){case"touchstart":case"touchmove":case"touchend":n=e.changedTouches[0];break;case"mousedown":case"mousemove":case"mouseup":default:n=e}return t.x=n.clientX,t.y=n.clientY,t},U=!1,B=function(e){var n=N();console.log("run function components");var t=Object(r.useRef)(null),o=Object(r.useRef)(""),c=Object(r.useState)(!1),i=Object(f.a)(c,2),s=i[0],p=i[1],h=Object(r.useRef)([]),k=Object(r.useRef)(null),C=Object(r.useRef)(),E=function(e){var n=t.current.getBoundingClientRect(),r=h.current[h.current.length-1],a={x:Math.round(3240*(e.x-n.left)/n.width),y:Math.round(3240*(e.y-n.top)/n.height)};r.points.push(a),function(e,n){e.strokeStyle=n.color,e.lineWidth=15,e.beginPath(),e.moveTo(n.points[0].x,n.points[0].y),n.points.forEach(function(n){e.lineTo(n.x,n.y)}),e.stroke()}(t.current.getContext("2d"),r)},O=function(e){var n=C.current;if(n){var t=function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?A(t,!0).forEach(function(n){Object(d.a)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):A(t).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}({},e,{uid:n.uid});n.sendMessage(t)}},S=function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},r=v()(n,16);return{start:function(n){U=!0,e(I(n))},move:function(e){U&&(e.stopPropagation(),r(I(e)))},stop:function(e){U=!1,t(I(e))}}}(function(e){h.current.push({color:o.current,points:[]}),E(e),O({kind:"pointStart",value:e})},function(e){E(e),O({kind:"pointMove",value:e})}),j=[{icon:a.a.createElement(y.a,null),name:"Save"},{icon:a.a.createElement(m.a,null),name:"color",hanler:function(){k.current.click(),p(!1)}}];return Object(r.useEffect)(function(){var e=function(e){!function(){var n=Object(l.a)(u.a.mark(function n(){var t;return u.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,x(e);case 2:t=n.sent,console.log(t),n.t0=t.kind,n.next="pointStart"===n.t0?7:"pointMove"===n.t0?10:"colorChange"===n.t0?12:14;break;case 7:return h.current.push({color:o.current,points:[]}),E(t.value),n.abrupt("break",14);case 10:return E(t.value),n.abrupt("break",14);case 12:return o.current=t.value,n.abrupt("break",14);case 14:case"end":return n.stop()}},n)}));return function(){return n.apply(this,arguments)}}()()};return function(){var n=Object(l.a)(u.a.mark(function n(){var t;return u.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return t=new W,n.next=3,t.init();case 3:window.conn=C.current=t,t.addEventListener("message",e);case 5:case"end":return n.stop()}},n)}));return function(){return n.apply(this,arguments)}}()(),function(){var n=C.current;n&&(n.removeEventListener("message",e),n.handleClose())}},[]),a.a.createElement("div",null,a.a.createElement("canvas",{className:n.root,ref:t,height:3240,width:3240,onMouseDown:S.start,onMouseMove:S.move,onMouseUp:S.stop,onTouchStart:S.start,onTouchMove:S.move,onTouchEnd:S.stop}),a.a.createElement(g.a,{ariaLabel:"SpeedDial",className:n.speedDial,icon:a.a.createElement(b.a,null),onClick:function(){return p(function(e){return!e})},onBlur:function(){return p(!1)},onClose:function(){return p(!1)},onFocus:function(){return p(!0)},onMouseEnter:function(){return p(!0)},onMouseLeave:function(){return p(!1)},open:s},j.map(function(e){return a.a.createElement(w.a,{key:e.name,icon:e.icon,tooltipTitle:e.name,onClick:e.hanler||console.log})})),a.a.createElement("input",{ref:k,type:"color",hidden:!0,onChange:function(e){var n=e.target.value;o.current=n,O({kind:"colorChange",value:n})}}))},J=function(){return a.a.createElement(a.a.Fragment,null,a.a.createElement(i.a,null),a.a.createElement("div",{className:"App"},a.a.createElement(B,null)))},F=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function G(e,n){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var t=e.installing;null!=t&&(t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),n&&n.onUpdate&&n.onUpdate(e)):(console.log("Content is cached for offline use."),n&&n.onSuccess&&n.onSuccess(e)))})}}).catch(function(e){console.error("Error during service worker registration:",e)})}c.a.render(a.a.createElement(J,null),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",function(){var n="".concat("","/service-worker.js");F?(function(e,n){fetch(e).then(function(t){var r=t.headers.get("content-type");404===t.status||null!=r&&-1===r.indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):G(e,n)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(n,e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")})):G(n,e)})}}({onSuccess:function(e){console.log("onSuccess",e)},onUpdate:function(e){console.log("onUpdate",e)}}),navigator.serviceWorker.ready.then(function(e){console.log(e)})}},[[58,1,2]]]);
//# sourceMappingURL=main.0335f8f5.chunk.js.map